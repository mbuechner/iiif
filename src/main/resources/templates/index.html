<!doctype html>
<html lang="de">
    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1" name="viewport">
        <title>Deutsche Digitale Bibliothek | IIIF Presentation API 3.0-Manifeste</title>
        <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet">
        <style>
            body {
                background: #EC0A3C;
                background: linear-gradient(276.83deg, #EC0A3C, #A5003B);
                min-height: 100vh;
            }
            .form-control::placeholder {
                color: #ccc;

            }
            .image-parent {
                max-height: 80px;
            }</style>
    </head>
    <body>
        <div class="container">
            <div class="row my-5">
                <div class="col-lg-12 mx-auto text-white text-center">
                    <h1 class="display-4">IIIF Presentation API 3.0</h1>
                    <p class="lead mb-0">Mit diesem Dienst können DDB-Objekte zu IIIF Presentation API 3.0-Manifeste umgewandelt werden.</p>
                    <p class="lead mb-0"> Außerdem können die IIIF-Manifeste in den verschiedenen Viewer betrachtet werden.</p>
                    <p class="lead">Implementierung auf <a class="text-white" href="https://github.com/mbuechner/iiif" target="_blank"><u>GitHub</u></a>. </p>
                </div>
            </div>
            <div class="row mb-3">
                <div class="p-1 bg-light rounded shadow-sm mb-4">
                    <div class="input-group">
                        <button aria-expanded="false" class="btn btn-light dropdown-toggle rounded-start col col-12 col-xl-3 mx-auto" data-bs-toggle="dropdown" id="displayType" type="button">IIIF Presentation API 3.0 Manifest</button>
                        <ul class="dropdown-menu dropdown-menu-start col col-12 col-xl-3 mx-auto" id="displayTypeDropdown">
                            <li>
                                <a class="dropdown-item" data-href="">IIIF Presentation API 3.0 Manifest</a>
                            </li>
                            <li>
                                <a class="dropdown-item" data-href="https://projectmirador.org/embed/?iiif-content=">Mirador 3</a>
                            </li>
                            <li>
                                <a class="dropdown-item" data-href="https://uv-v4.netlify.app/#?manifest=">Universal Viewer 4</a>
                            </li>
                            <li>
                                <a class="dropdown-item" data-href="https://samvera-labs.github.io/clover-iiif/?iiif-content=">Clover</a>
                            </li>
                            <li>
                                <a class="dropdown-item" data-href="https://ncsu-libraries.github.io/annona/tools/#/display?viewtype=iiif-rangestoryboard&amp;settings=%7B%22fullpage%22%3Atrue%7D&amp;url=">Annona</a>
                            </li>
                            <li>
                                <a class="dropdown-item" data-href="https://presentation-validator.iiif.io/validate?version=3.0&amp;url=">Presentation API Validator</a>
                            </li>
                        </ul>
                        <input aria-label="Text input with dropdown button" class="form-control col col-12 col-xl-8 mx-auto" id="input" placeholder="https://www.deutsche-digitale-bibliothek.de/item/CRHMM44XWLG7ZNH55BQ5GSAHTYLXJ7Z4" type="text">
                        <a class="btn bg-light rounded-end disabled col col-12 col-xl-1 mx-auto" data-href="" href="#" id="los" role="button" target="_blank">Los!</a>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-12 col-xxl-10 mx-auto">
                    <div class="list-group">
                        <div id="mylistgroupitems"></div>
                    </div>
                </div>
            </div>
        </div>
        <script crossorigin="anonymous" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
        <script crossorigin="anonymous" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
        <script crossorigin="anonymous" integrity="sha512-HYiNpwSxYuji84SQbCU5m9kHEsRqwWypXgJMBtbRSumlx1iBB6QaxgEBZHSHEGM+fKyCX/3Kb5V5jeVXm0OglQ==" src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.1.0/mustache.min.js"></script>
        <script>
            const items = {
                "items": [{
                        "link": "N57I3YRBVW73LLC7V6W5Z6PDHJAEMXCP",
                        "text": "Ein in LIDO digitalisiertes Buch mit 469 Seiten (!). Gut geeingnet für die Anzeige in den IIIF-Viewern."
                    }, {
                        "status": "warning",
                        "link": "SDD2UHI6DHFQT6MOWQBQEWJRECTUCWGW",
                        "text": "Beethovens 5. in vier Audiodateien. Leider spielt der Universal Viewer die Audio-Daten nicht ab, weil das Manifest die „duration“ nicht enthält. Diese Information wird aktuell nicht in der DDB gespeichert."
                    }, {
                        "link": "XL5HT36MHHYBPY7SGUT7YUJBJMPVSUII",
                        "text": "Ein Museumsobjekt mit umfangreichen Metadaten."
                    }, {
                        "link": "TLCKVDW6HU7KHWM6I4VIE3VZ7R2XPXIY",
                        "text": "Ein Museumsobjekt einer langen Bildunterschrift unter einem hochaufgelösten Digtalisat."
                    }, {
                        "link": "CZNOZMUMWB6HNRDKI445X3Q6WNC63TFL",
                        "text": "Ein Museumsobjekt mit 15 Digitalisaten und umfangreichen Metadaten."
                    }, {
                        "link": "GO7LV4P263UK7GRATYYRBRDFQLG4QCJW",
                        "text": "Ein Museumsobjekt mit einem hochaufgelösten Digitalisat."
                    }, {
                        "link": "IGBWWKK6ACCZAM5SMI34F6GEQO5RNXUG",
                        "text": "Zeitung"
                    }, {
                        "link": "KPPFXEP6DRPCK6DAOL22RPURI5MHF7RC",
                        "text": "Band"
                    }, {
                        "link": "GHG4AHXZLSWKI5WFVOGIHZZQU2C5RQNN",
                        "text": "Ein Video"
                    }, {
                        "link": "FEH5FOLF4MDDZIEER6AA7N3SMASCSYBM",
                        "text": "Ein Video"
                    }, {
                        "link": "EUO5IXF72NFMHD7UGD3X7AWQXNTQSPTK",
                        "text": "Ein Audio"
                    }, {
                        "link": "XXJ7DRMCMYAO6UY434KUHQLEQ23W6MF7",
                        "text": "Ein Video"
                    }, {
                        "link": "LN7D6DTSLX7XU4TULJHAHREPJA3MDYTC",
                        "text": "3D-Objekte"
                    }, {
                        "link": "GJS5MQFEZENWD7S2IX4LUKYPWQKMJ5BH",
                        "text": "Bilder mit einer Audio-Datei."
                    }, {
                        "link": "2NGUCS22WFYDLCOUUWZWJ6BDJQT5MNH7",
                        "text": "Ein hochaufgelöstes Bild"
                    }, {
                        "link": "NIHZBW7QZS352TCBKRUQPXPO2LGFSFJN",
                        "text": "Zwei hochaufgelöste Fotos aus der Papyrussammlung."
                    }, {
                        "link": "UT7QCBPP626TE3HTJDMJN7HVJ22IUEEO",
                        "text": "Sechs hochaufgelöste Fotos einer Flöte."
                    }, {
                        "status": "warning",
                        "link": "7PQO65ASPKENCHEOMMQLLE3INGF5NRYV",
                        "text": "Zwei Audiodateien mit Schallplattencover. Die Cover werden in der DDB nicht extra angezeigt und als Platzhalterbild für die Audio-Dateien benutzt. IIIF sieht vor, dass die Dauer der Audiodateien im Manifest angegeben werden. Diese Information liegt in der DDB nicht vor, entsprechend kann z.B. der universalviewer die Daten nicht korrekt anzeigen."
                    }, {
                        "status": "warning",
                        "link": "UODH7ABRU3KEFW4W3LTX2EYKOD6UKANO",
                        "text": "Ein Video. Das Video hat zusätzlich ein Still, das in den IIIF-Manifesten und im Gegensatz zum DDB-Portal angezeigt wird. Der Universal Viewer benötigt zwingen die Spieldauer eines Videos. Diese Information kann von der DDB nicht zur Verfügung gestellt werden, entsprechend funktioniert die Anzeige von Video/ Audio im Universal-Viewer nicht korrekt."
                    }, {
                        "status": "warning",
                        "link": "R2YZORYOVZA3UEZYTQFB3JCGQUWNP3C7",
                        "text": "Eine PDF-Datei mit Vorschaubild. PDFs werden aktuell nur vom Universal Viewer unterstützt. Der Mirador 3 Viewer zeigt z.B. nur eine weiße Seite an."
                    }, {
                        "link": "IRMHSA4Q6RXQVYADHYNIQNVE53T6JREJ",
                        "text": "Eine 106-seitige Archivalie. Das Laden dauert länger, weil für jedes Digitalisat die maximale Auflösung über den IIIF Image-Dienst herausgefunden werden muss."
                    }, {
                        "status": "danger",
                        "link": "F3WJONMF6NXB3IJQLRYV5LR67KDPMQTA",
                        "text": "Vimeo-Videos können in IIIF nicht repräsentiert werden. Entsprechend zeigt keiner der Viewer diese an."
                    }, {
                        "link": "TTNVQWVXY3AKILUHHULXB5H2ZHZGEKOO",
                        "text": "Ein hochaufgelöstes Digitalisat aus der Peter Tamm Sen. Stiftung."
                    }, {
                        "status": "warning",
                        "link": "QCWBCVL6F64T6PHGAUCIFC57CWUC7YXV",
                        "text": "Eine Bild-, eine Video- und sechs Audio-Dateien."
                    }, {
                        "link": "D7CTTZ55NCSYJMZFBOAEE5PSS2PVODZT",
                        "text": "Monographie"
                    }, {
                        "link": "C4OICKVZCLE3E2HVAQGEVKK6MOGJOLKV",
                        "text": "Abschnitt"
                    }, {
                        "link": "M3FDWSLR53SH7A25HS34Z5AVEYMYLSZV",
                        "text": "Heft"
                    }, {
                        "link": "FNY2WQQOGN4ZV6DJIADNKWFWXH2F73HT",
                        "text": "Band"
                    }]
            };

            const template = ' \
            {{#items}} \
            <a data-id="{{link}}" class="list-group-item {{#status}}list-group-item-{{status}} {{/status}}d-flex justify-content-between align-items-center" href="https://www.deutsche-digitale-bibliothek.de/item/{{link}}"> \
            <div> \
            <div class="fw-bold list-group-item-title">Titel</div> \
            <div class="row small"><div class="col-12 mb-1 text-break">https://www.deutsche-digitale-bibliothek.de/item/{{link}}</div><div class="col-12 text-muted">{{text}}</div></div> \
            </div> \
            <img alt="" class="img-fluid image-parent list-group-item-image"> \
            </a> \
            {{/items}}';

            $(document).ready(function () {
                function valueChanged() {
                    const url = window.location.href.endsWith("/") ? window.location.href : window.location.href + "/";
                    const string = $("#input").val();
                    const regexp = new RegExp("^https:\/\/www(-[Qq][12])?\.deutsche-digitale-bibliothek\.de\/item\/([ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]{32})$", "g");
                    const match = regexp.exec(string);
                    if (match !== null && typeof match[1] !== "undefined" && typeof match[2] !== "undefined") {
                        if ($("#los").attr("data-href").length === 0) {
                            $("#los").attr("href", url + match[2] + "?system=" + match[1].substring(1));
                        } else {
                            $("#los").attr("href", $("#los").attr("data-href") + encodeURIComponent(url + match[2] + "?system=" + match[1].substring(1)));
                        }
                        $("#los").removeClass("disabled");
                    } else if (match !== null && typeof match[2] !== "undefined") {
                        if ($("#los").attr("data-href").length === 0) {
                            $("#los").attr("href", url + match[2]);
                        } else {
                            $("#los").attr("href", $("#los").attr("data-href") + encodeURIComponent(url + match[2]));
                        }
                        $("#los").removeClass("disabled");
                    } else {
                        $("#los").attr("href", "#");
                        $("#los").addClass("disabled");
                    }
                }

                function extractData(id, callback) {
                    $.getJSON('https://api.deutsche-digitale-bibliothek.de/2/items/' + id, function (data) {
                        const images = $(data.binaries.binary).filter(function (i, n) {
                            return n.mimetype === 'image/jpeg';
                        });

                        var extractedData = {};
                        extractedData.title = data.view.item.title;
                        if (images[0] && images[0].ref !== undefined) {
                            extractedData.binary = "https://iiif.deutsche-digitale-bibliothek.de/image/2/" + images[0].ref + "/full/!116,87/0/default.jpg";
                        }
                        callback(extractedData);
                    });
                }
                // see https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
                function shuffle(array) {
                    let currentIndex = array[ 'items'].length, randomIndex;
                    // While there remain elements to shuffle.
                    while (currentIndex !== 0) {
                        // Pick a remaining element.
                        randomIndex = Math.floor(Math.random() * currentIndex);
                        currentIndex--;
                        // And swap it with the current element.
                        [array[ 'items'][currentIndex], array[ 'items'][randomIndex]] = [
                            array[ 'items'][randomIndex], array[ 'items'][currentIndex]];
                    }
                    return array;
                }

                $("#mylistgroupitems").html(Mustache.render(template, shuffle(items)));

                $("#mylistgroupitems > .list-group-item").each(function (index, element) {
                    const id = $(element).attr("data-id");
                    extractData(id, function (data) {
                        if (data !== undefined) {
                            $($(element).find('.list-group-item-title')[0]).text(data.title);
                            $($(element).find('.list-group-item-image')[0]).attr('src', data.binary);
                        }
                    });
                });

                $(".dropdown-menu li a").click(function () {
                    $(".btn:first-child").text($(this).text());
                    $(".btn:first-child").val($(this).text());
                    $("#los").attr("data-href", $(this).attr("data-href"));
                    valueChanged();
                });

                $('#input').on('input', function () {
                    valueChanged();
                });

                $('#input').on('keydown', function (e) {
                    if (e.which === 13 && !$("#los").hasClass("disabled")) {
                        window.open($("#los").attr("href"), '_blank');
                    }
                });

                $('.list-group-item').click(function (e) {
                    e.preventDefault();
                    $('#input').val($(this).attr("href"));
                    valueChanged();
                    window.scrollTo({
                        top: 0, behavior: 'smooth'
                    });
                });
            });</script>
    </body>
</html>
